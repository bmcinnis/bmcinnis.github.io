<!DOCTYPE html> <html> <head> <title>Brian McInnis</title> <meta name="viewport" content="width=device-width, initial-scale=1.0"> </head> <script id="jquery" type="text/javascript" src="https://code.jquery.com/jquery-2.2.4.min.js"></script> <script id="underscore" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
	<script id="d3" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.5.0/d3.js"></script>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<script type="text/javascript">
		var isChrome = !!window.chrome && !!window.chrome.webstore;
		
		/* 	Wavey color changer function */
		var wavey = function(color){
			var colorSet = {'green':["#e6fff2","#ccffe6","#b3ffd9","#99ffcc","#80ffbf","#66ffb3","#4dffa6","#33ff99",
						"#1aff8c","#00ff80","#00e673","#00cc66","#00b359","#00cc66","#00e673","#00ff80",
						"#1aff8c","#33ff99","#4dffa6","#66ffb3","#80ffbf","#99ffcc","#b3ffd9","#ccffe6","#e6fff2"],
					'blue':["#e6f5ff","#ccebff","#b3e0ff","#99d6ff","#80ccff","#66c2ff","#4db8ff","#33adff","#1aa3ff",
						"#0099ff","#1aa3ff","#33adff","#4db8ff","#66c2ff","#80ccff","#99d6ff","#b3e0ff",
						"#ccebff","#e6f5ff","#ffffff"],
					'red':["#ffe6f2","#ffcce6","#ffb3d9","#ff99cc","#ff80bf","#ff66b3","#ff4da6","#ff3399","#ff1a8c","#ff0080","#e60073",
						"#cc0066","#ff0000","#ff1a1a","#ff3333","#ff4d4d","#ff6666","#ff8080","#ff9999","#ffb3b3","#ffcccc","#ffe6e6"]};
			
			$('.whiteboard').empty();
			var svgSize = {'height':$('.whiteboard').height(), 'width':$('.whiteboard').width()}
			console.log(svgSize);

			/*
			var lineData = _.map(_.range(0.05, 0.9, 0.15),
						function(num){
							return {'x':num*svgSize['width'],
								'y':_.random(-1*(svgSize['height']*0.25),svgSize['height']*0.25)+(svgSize['height']/2)};
						});
			*/
			var lineData = [{'x':0.30*svgSize['width'],'y':(svgSize['height'])*_.random(0.1,0.25)},
				{'x':0.50*svgSize['width'],'y':(svgSize['height'])*_.random(0.30,0.50)},
			 	{'x':0.70*svgSize['width'],'y':(svgSize['height'])*_.random(0.2,0.35)}]
			
			console.log(lineData);

			var lineFunction = d3.line()
						.x(function(d){return d.x;})
						.y(function(d){return d.y;})
						.curve(d3.curveBasis);

			var svgContainer = d3.select(".whiteboard");

			var colors = colorSet[color];
			for (var ii in _.range(-1*(colors.length), colors.length , 2)){
				var cs = colors.shift();
				var line = lineData.slice();

				var line = _.map(line, function(item){
					item['x'] += Math.abs(ii)*0.5;
					return item;
				});				

				line.unshift({'x':0,'y':((ii/colors.length)*(svgSize["height"]/2))});
				line.push({'x':svgSize['width'],'y':(svgSize["height"]/2)-(ii*25)});

				svgContainer.append("path")
							.attr("d", lineFunction(line))
							.attr("stroke", cs)
							.attr("stroke-width",1)
							.attr("fill","none");
			}

		};
	
		/*	Exciting things are happening!	*/
		$(document).ready(function(){
			var color = _.sample(['green','blue','red'],1);
			wavey(color);


			/*
				Set up speech recognition
			*/
			if(isChrome){
				var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;
				var SpeechGrammarList = SpeechGrammarList || webkitSpeechGrammarList;
				var SpeechRecognitionEvent = SpeechRecognitionEvent || webkitSpeechRecognitionEvent;

				/* 	Speech recognition support 	*/
				var happyWords = ["stoked","nice","good","great","wow","super","terrific","fantastic","right on"];
				var grammar = '#JSGF V1.0; grammar colors; public <color> = ' + happyWords.join(' | ') + ' ;'

				var recognition = new SpeechRecognition();
				var speechRecognitionList = new SpeechGrammarList();

				speechRecognitionList.addFromString(grammar, 1);
				recognition.grammars = speechRecognitionList;
				//recognition.continuous = false;
				recognition.lang = 'en-US';
				recognition.interimResults = false;
				recognition.maxAlternatives = 1;

				/* 	Toggling speech recognition */
				$('.volume').on('click',function(){
					if($('.volume span').hasClass('glyphicon-volume-up')){
						$('.volume span').addClass('glyphicon-volume-off');
						$('.volume span').removeClass('glyphicon-volume-up')	
						$('.volume').addClass('btn-danger');
						$('.volume').removeClass('btn-primary');
					}else{
						$('.volume span').removeClass('glyphicon-volume-off');
						$('.volume span').addClass('glyphicon-volume-up');
						$('.volume').removeClass('btn-danger');
						$('.volume').addClass('btn-primary');
						recognition.start();
						console.log('Give me some happy words!');
					}
				});

				recognition.onresult = function(event) {
					var last = event.results.length - 1;
					var happiness = event.results[last][0].transcript;
					console.log('Result received: ' + happiness);
					console.log('Confidence: ' + event.results[0][0].confidence);
				}

				recognition.onspeechend = function() {
	  				recognition.stop();
					$('.volume span').addClass('glyphicon-volume-off');
					$('.volume span').removeClass('glyphicon-volume-up')	
					$('.volume').addClass('btn-danger');
					$('.volume').removeClass('btn-primary');
				}

				recognition.onnomatch = function(event) {
 					console.log('Must have been a sad word, sorry didnt recognize it!');
				}

				
			}else{
				$('.volume').remove();
			}

		});
		$(window).resize(function(){
			var color = _.sample(['red','blue','green'],1);
			wavey(color);
		});
	</script>
	<body>
		<svg class="whiteboard" height="100%" width="100%"></svg>
		<button type="button" class="btn btn-danger btn-small volume" aria-label="Left Align">
			<span class="glyphicon glyphicon-volume-off" aria-hidden="true"></span>
		</button>
	</body>
	<style>
		svg {
	 		position:fixed;
			top:0px;
			left:0px;
			height:100%;
			width:100%;	
		}
		.volume{
			position: fixed;
			z-index:2;
			bottom:10px;
			right:10px;
		}
	</style>
</html>
